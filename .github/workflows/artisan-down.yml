name: Artisan Down

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  down:
    runs-on: self-hosted

    steps:
      - name: Ejecutar PHP Artisan Down
        run: |
          cd C:\laragon\www\mar
          php artisan optimize
          php artisan optimize:clear
          php artisan down
          echo ------ INFO DEL RUNNER ------
          echo RUNNER NAME: %RUNNER_NAME%
          echo RUNNER OS: %RUNNER_OS%

      - name: Notificar por Telegram
        if: always() # Siempre se ejecuta, falle o no
        run: |
          STATUS="${{ job.status }}"
          MESSAGE="Workflow '${{ github.workflow }}' finaliz√≥ con estado: $STATUS en el runner ${{ runner.name }}"

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="$MESSAGE"
