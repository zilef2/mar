name: Artisan optimize Down

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  down:
    runs-on: self-hosted

    steps:
      - name: Ejecutar PHP Artisan Down
        run: |
          cd C:\laragon\www\mar
          php artisan optimize
          php artisan optimize:clear
          
          echo RUNNER NAME: %RUNNER_NAME%
          echo RUNNER OS: %RUNNER_OS%

      - name: Notificar a Telegram
        if: always()
        shell: pwsh
        run: |
            $TOKEN = "${{ secrets.TELEGRAM_BOT_TOKEN }}"
            $CHATID = "${{ secrets.TELEGRAM_CHAT_ID }}"
            $STATUS = "${{ job.status }}"
            $MSG = "Workflow '${{ github.workflow }}' finaliz√≥ con estado: $STATUS"

            curl -Method Post `
              -Uri "https://api.telegram.org/bot$TOKEN/sendMessage" `
              -Body @{
                chat_id = $CHATID
                text    = $MSG
              }

